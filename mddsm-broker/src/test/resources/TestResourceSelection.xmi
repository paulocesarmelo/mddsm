<?xml version="1.0" encoding="UTF-8"?>
<sb.base:Manager
    xmi:version="2.0"
    xmlns:xmi="http://www.omg.org/XMI"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:sb.base="http://www.inf.ufg.br/mestrado/sb/base"
    xmlns:sb.base.common="http://www.inf.ufg.br/mestrado/sb/base/common"
    xsi:schemaLocation="http://www.inf.ufg.br/mestrado/sb/base http://www.inf.ufg.br/mestrado/sb/base/common"
    name="HelloManager">
  <iface Name="ResourceSelection">
    <provides
        name="selects">
      <parameters
          name="resourceName"/>
      <parameters
          name="args"/>
    </provides>
    <provides
        name="byPassingPolicy">
      <parameters
          name="resourceName"/>
      <parameters
          name="args"/>
    </provides>
  </iface>
  <actions xsi:type="sb.base.common:EnqueueCall"
      name="callResourceByPassingPolicy"
      call="//@resourceManager/@iface/@provides.0">
    <parameters
        name="resourceName"/>
    <parameters
        name="args"/>
    <bindings
        parameter="//@iface/@provides.0/@parameters.0">
      <value
          xsi:type="sb.base.common:ParameterValue"
          parameter="//@iface/@provides.1/@parameters.0"/>
    </bindings>
    <bindings
        parameter="//@iface/@provides.1/@parameters.1">
      <value
          xsi:type="sb.base.common:ParameterValue"
          parameter="//@iface/@provides.1/@parameters.1"/>
    </bindings>
  </actions>
  <actions xsi:type="sb.base.common:MacroAction"
      name="macroActionCallResource"
      impl="br.inf.ufg.mddsm.broker.tests.MacroActionCallResource">
    <parameters
        name="resourceName"/>
    <parameters
        name="args"/>
  </actions>
  <handlers
      signal="//@iface/@provides.1">
    <action
        action="//@actions.0">
      <bindings
          parameter="//@iface/@provides.1/@parameters.0">
        <value
            xsi:type="sb.base.common:ParameterValue"
            parameter="//@iface/@provides.1/@parameters.0"/>
      </bindings>
      <bindings
          parameter="//@iface/@provides.1/@parameters.1">
        <value
            xsi:type="sb.base.common:ParameterValue"
            parameter="//@iface/@provides.1/@parameters.1"/>
      </bindings>
    </action>
  </handlers>
  <handlers
      signal="//@resourceManager/@iface/@provides.0"
      enabled="false">
    <action
        action="//@actions.1">
      <bindings
          parameter="//@iface/@provides.1/@parameters.0">
        <value
            xsi:type="sb.base.common:ParameterValue"
            parameter="//@iface/@provides.1/@parameters.0"/>
      </bindings>
      <bindings
          parameter="//@iface/@provides.1/@parameters.1">
        <value
            xsi:type="sb.base.common:ParameterValue"
            parameter="//@iface/@provides.1/@parameters.1"/>
      </bindings>
    </action>
  </handlers>
  <stateManager>
    <stateTypes
        name="mart"
        key="//@stateManager/@stateTypes.0/@properties.0">
      <properties
          name="mart"/>
    </stateTypes>
  </stateManager>
  <resourceManager
      xsi:type="sb.base:InstanceResourceManager"
      Name="resourceManager">
    <iface Name="ResourceCallee">
      <provides
          name="callResourceByPassingPolicy">
        <parameters
            name="args"/>
        <parameters
            name="resourceName"/>
      </provides>
      <signals
          name="callResourceByPassingPolicy">
        <parameters
            name="args"/>
        <parameters
            name="resourceName"/>
      </signals>
    </iface>
    <instances
        name="resource1"
        impl="br.inf.ufg.mddsm.broker.tests.Resource1"
        iface="//@resourceManager/@iface">
      <features
          name="resource1">
        <attributes
            name="resourceName"
            value="resource1"/>
      </features>
    </instances>
    <instances
        name="resource2"
        impl="br.inf.ufg.mddsm.broker.tests.Resource2"
        iface="//@resourceManager/@iface">
      <features
          name="resource2">
        <attributes
            name="resourceName"
            value="resource2"/>
      </features>
    </instances>
  </resourceManager>
  <policyManager>
    <points
        signal="//@iface/@provides.0">
      <request
          handler="//@policyManager/@handlers.0">
        <bindings
            parameter="//@policyManager/@handlers.0/@parameters.0">
          <value
              xsi:type="sb.base.common:ParameterValue"
              parameter="//@policyManager/@handlers.0/@parameters.0"/>
        </bindings>
        <bindings
            parameter="//@iface/@provides.0/@parameters.1">
          <value
              xsi:type="sb.base.common:ParameterValue"
              parameter="//@iface/@provides.0/@parameters.1"/>
        </bindings>
      </request>
    </points>
    <handlers
        handlerImpl="br.inf.ufg.mddsm.broker.tests.ResourceSelectionHandler">
      <parameters
          name="resourceName"/>
      <evaluation>
        <feature
            xsi:type="sb.base.common:ParameterValue"
            parameter="//@policyManager/@handlers.0/@evaluation/@context/@parameters.0"/>
        <contextBinding
            parameter="//@policyManager/@handlers.0/@parameters.0">
          <value
              xsi:type="sb.base.common:ExpressionValue"
              value="resourceName"/>
        </contextBinding>
        <context>
          <parameters
              name="resourceName"/>
        </context>
      </evaluation>
    </handlers>
    <policies
        name="selectResource1"
        businessValue="100"
        feature="resource1">
      <decision
          parameter="resourceName"
          operation="equalTo"
          value="resource1"/>
    </policies>
    <policies
        name="selectResource2"
        businessValue="100"
        feature="resource2">
      <decision
          parameter="resourceName"
          operation="equalTo"
          value="resource2"/>
    </policies>
  </policyManager>
</sb.base:Manager>
